<!DOCTYPE html>
<html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init">
<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//piwik.mritd.me/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//piwik.mritd.me/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <title>DBA视频笔记 &mdash; 漠然</title>
    <link rel="stylesheet" href="https://mritd.b0.upaiyun.com/assets/vendor/primer-css/css/primer.css">
    <link rel="stylesheet" href="https://mritd.b0.upaiyun.com/assets/vendor/primer-markdown/dist/user-content.min.css">
    <link rel="stylesheet" href="https://mritd.b0.upaiyun.com/assets/vendor/octicons/octicons/octicons.css">
    <link rel="stylesheet" href="https://mritd.b0.upaiyun.com/assets/css/components/collection.css">
    <link rel="stylesheet" href="https://mritd.b0.upaiyun.com/assets/css/components/repo-card.css">
    <link rel="stylesheet" href="https://mritd.b0.upaiyun.com/assets/css/sections/repo-list.css">
    <link rel="stylesheet" href="https://mritd.b0.upaiyun.com/assets/css/sections/mini-repo-list.css">
    <link rel="stylesheet" href="https://mritd.b0.upaiyun.com/assets/css/components/boxed-group.css">
    <link rel="stylesheet" href="https://mritd.b0.upaiyun.com/assets/css/globals/common.css">
    <link rel="stylesheet" href="https://mritd.b0.upaiyun.com/assets/vendor/share.js/dist/css/share.min.css">
    <link rel="stylesheet" href="https://mritd.b0.upaiyun.com/assets/css/globals/responsive.css">
    <link rel="stylesheet" href="https://mritd.b0.upaiyun.com/assets/css/posts/index.css">
    <!-- Latest compiled and minified CSS -->
    

    
    <link rel="canonical" href="https://mritd.me/2016/01/08/DBA%E8%A7%86%E9%A2%91%E7%AC%94%E8%AE%B0/">
    <link rel="alternate" type="application/atom+xml" title="漠然" href="/feed.xml">
    <link rel="shortcut icon" href="/favicon.ico">
    
    <meta property="og:title" content="DBA视频笔记">
      
    <meta name="keywords" content="ORACLE,DBA">
    <meta name="og:keywords" content="ORACLE,DBA">
      
    <meta name="description" content="">
    <meta name="og:description" content="">
      
    
    
        
    
    <meta property="og:url" content="https://mritd.me/2016/01/08/DBA%E8%A7%86%E9%A2%91%E7%AC%94%E8%AE%B0/">
    <meta property="og:site_name" content="漠然">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh_CN" />
    
    <meta property="article:published_time" content="2016-01-08">
    
    <script src="https://mritd.b0.upaiyun.com/assets/vendor/jquery/dist/jquery.min.js"></script>
    <script src="https://mritd.b0.upaiyun.com/assets/js/jquery-ui.js"></script>
    <script type="text/javascript">
    function toggleMenu() {
        var nav = document.getElementsByClassName("site-header-nav")[0];
        if (nav.style.display == "inline-flex") {
          nav.style.display = "none";
        } else {
          nav.style.display = "inline-flex";
        }
    }
    </script>
</head>
<body class="" data-mz="">
    <header class="site-header">
        <div class="container">
            <h1><a href="/" title="漠然"><span class="octicon octicon-mark-github"></span> 漠然</a></h1>
            <button class="collapsed mobile-visible" type="button" onclick="toggleMenu();">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <nav class="site-header-nav" role="navigation">
                
                <a href="/" class=" site-header-nav-item" target="" title="首页">首页</a>
                
                <a href="/categories/" class=" site-header-nav-item" target="" title="分类">分类</a>
                
                <a href="/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a>
                
                <a href="/open-source/" class=" site-header-nav-item" target="" title="开源">开源</a>
                
                <a href="/links/" class=" site-header-nav-item" target="" title="链接">链接</a>
                
                <a href="/about/" class=" site-header-nav-item" target="" title="关于">关于</a>
                
            </nav>
        </div>
    </header>
    <!-- / header -->

    <section class="collection-head small geopattern" data-pattern-id="DBA视频笔记">
<div class="container">
  <div class="columns">
    <div class="column three-fourths">
      <div class="collection-title">
        <h1 class="collection-header">DBA视频笔记</h1>
        <div class="collection-info">
          
          <span class="meta-info">
            <span class="octicon octicon-calendar"></span> 2016/01/08
          </span>
          
          
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href="/categories/#ORACLE" title="ORACLE">ORACLE</a>
          </span>
          
        </div>
      </div>
    </div>
  </div>
</div>
</section>
<!-- / .banner -->
<section class="container content">
<div class="columns">
  <div class="column three-fourths" >
    <article class="article-content markdown-body">
    <p><img src="https://mritd.b0.upaiyun.com/markdown/hexo_oracledatabase_log.png" alt="Oracle Logo" /></p>

<blockquote>
  <p>数据库是个硬伤，最近在X宝(真特么是个神奇的地方)搞了点OCP、OCA、OCM的视频，看点记点……不定时更新……</p>
</blockquote>

<!--more-->

<h2 id="sql部分">SQL部分</h2>

<h3 id="sql分类">SQL分类</h3>

<ol>
  <li>DML 数据操纵语言
  SELECT、INSERT、DELETE、UPDATE、MERGE(11G)
  SELECT 对表数据进行读操作
  INSERT、DELETE、UPDATE 对表数据进行读操作 会引起UNDO，UBDO会引起REDO</li>
  <li>DDL 数据定义语言
  CREATE、ALTER、DROP、TRUNCAT、RENAME、COMMON (会更新数据字典)</li>
  <li>TCL 事务操作语言
  COMMIT、ROLLBAK、SAVEPOINT</li>
  <li>DCL 权限操作语言
  GRANT、REVOKE</li>
</ol>

<h3 id="基本sql">基本SQL</h3>

<ol>
  <li>数据类型
    <ul>
      <li>字符型
 CHAR                    固定字符，最长2000 (建表后无数据可改变，有数据只能涨)
 VARCHAR2                可变长度，最长4000，最小1
 NCHAR/NVARCHAR2         NCAHR/NVARCHAR2类型的列使用国家字符集(<strong>字母汉字一视同仁，都视为同一长度</strong>)
 RAW/LANG RAW            固定/可变长二进制数据长度，最大2G (老类型，逐步淘汰)
 LONG                    可变长字符数据，最大2G，具有VARCHAR2特性，<strong>一个表最多1列</strong> (老类型，逐步淘汰)</li>
    </ul>
  </li>
</ol>

<ul>
  <li>
    <p>数值型
NUMBER(P,S)             实数类型，以可变长内部类型存储数据，内部格式精度高达38位
INT                     NUMBER子类型，范围同上</p>
  </li>
  <li>
    <p>日期型
DATE                    日期普通格式，精度只能到秒
TIMESTAMP               日期扩展格式，精度可达秒后小数点9位(十亿分之一秒)
TIMESTAMP WHITH TIMEZONE          带时区
TIMESTAMP WITH LOCAL TIMEZONE     时区转换成本地日期</p>
  </li>
  <li>
    <p>LOB型(大对象)
10G引入，11G重新定义，在字段中存储大数据，所有大对象最大4G
CLOB                    用于存储单字节字符数据，包含在数据库内(查询必须使用 like)
NCLOB                   用于存储多字节字符数据
BLOB                    用于存储二进制数据，包含在数据库内
BFILE                   存储在数据库之外的二进制文件中，文件中数据只能只读访问</p>
    <blockquote>
      <p>CLOB、NCLOB、BLOB都是内部LOB类型，没有LONG每个表只能有一列的限制；保存图片或者电影BLOB最好，小说等文本使用VLOB最好；LONG、RAW即将废弃，但并未完全废弃，11G重要视图dba_views，对于text(视图定义)仍沿用LONG类型</p>

      <p>Oracle 11g 重新设计了大对象，提出Secure Lobs的概念，相关参数是 <code class="highlighter-rouge">db_securefile</code>，采用Secure File的前提是11g以上版本，ASSM管理等；符合这些条件的BasicFile Lobs也可以转换成 SecureFile Lobs，<strong>较之前的BasicFile Lobs，SecureFile Lobs有极大改进：压缩、去重、加密</strong></p>

      <p><strong>当 <code class="highlighter-rouge">CREATE TABLE</code> 定义LOB列时，往往用到 <code class="highlighter-rouge">LOB_storage_clause</code>；之后对LOB的操作往往是ORACLE提供的 <code class="highlighter-rouge">DBMS_LOB</code> 包，通过编写 PL/SQL 块来对LOB数据进行管理</strong></p>
    </blockquote>
  </li>
</ul>

<ol>
  <li>数据类型转换
    <ul>
      <li>隐性类型转换
 是指ORACLE自动完成的类型转换；自一些带有明显意图的字面值上，可由ORACLE自主判断进行数制转换，如
        <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">-- ORACLE 自主将字符型'7788'转换为数值型7788进行比较</span>
 <span class="k">SELECT</span> <span class="n">EMPNO</span> <span class="k">FROM</span> <span class="n">EMP</span> <span class="k">WHERE</span> <span class="n">EMPNO</span> <span class="o">=</span><span class="s1">'7788'</span><span class="p">;</span>
 <span class="c1">-- 将日期型转换为字符型进行长度判断</span>
 <span class="k">SELECT</span> <span class="k">LENGTH</span><span class="p">(</span><span class="n">SYSDATE</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">DUAL</span><span class="p">;</span>
 <span class="c1">-- 将字符型 '1028' 转换成数值型进行计算</span>
 <span class="k">SELECT</span> <span class="s1">'1028'</span><span class="o">+</span><span class="mi">123</span> <span class="k">FROM</span> <span class="n">DUAL</span><span class="p">;</span>
 <span class="c1">-- 将数值型123转换为字符型进行拼接</span>
 <span class="k">SELECT</span> <span class="s1">'1028'</span><span class="o">||</span><span class="mi">123</span> <span class="k">FROM</span> <span class="n">DUAL</span><span class="p">;</span>
</code></pre></div>        </div>
      </li>
      <li>显性类型转换
 TO_CHAR、TO_DATE、TO_NUMBER
 <img src="https://mritd.b0.upaiyun.com/markdown/hexo_ORACLE_datacoversion.png" alt="转换图" /></li>
    </ul>
  </li>
  <li>单行函数
  ``` sql
  –字符函数</li>
</ol>

<p>lower(‘SQL’)                    –返回小写
  upper(‘sql’)                    –返回大写
  initcap(‘sql’)                  –首字母大写
  concat(‘sql’,’test’)            –字符串拼接
  substr(‘String’,1,3)            –字符串截取
  instr(‘sqlsq#l#sql’,’#’,3)      –从第3个位置查找’#’字符绝对位置
  length(‘String’)                –返回字符串长度
  lpad(‘test’10,’#’)              –左填充
  rpad(‘test’,10,’*’)             –右填充
  replace(‘11111q111’,’q’,’0’)    –字符串替换
  trim(‘  1  ‘)                   –首尾去空格</p>

<p>–数值函数</p>

<p>round(p,s)                –对指定值做四舍五入，s为正数时表示小数点后保留位数，
                              –也可位负数，意义不大；可用于按照指定精度对十进制数做四舍五入
  round(45.923,1)                 –结果45.9
  round(45.923,0)                 –结果46
  round(45.923,-1)                –结果50</p>

<p>trunc(p,s)                      –对指定数值进行取整，可按精度截断指定十进制数
  trun(45.923,0)                  –结果45</p>

<p>mod(100,12)                     –取余</p>

<p>–日期函数</p>

<p>–日期数值在ORALCE中按照数字存储，所以可以进行加减运算，计算时以天为单位，缺省格式 DD-MON-RR
  SELECT SYSDATE+2 FROM DUAL;                                     –当前日期+2天
  SELECT SYSDATE+2/24 FROM DUAL;                                  –当前日期+2小时
  TO_DATE(‘2016-01-01 21:40:30’,’YYYY-MM-DD HH24:MI:SS’)          –字符串转日期
  TO_CHAR(SYSDATE,’YYYY-MM-DD HH24:MI:SS’)                        –日期转字符串
  MONTHS_BETWEEN                                                  –计算两个日期之间相差月数
  ADD_MONTHS                                                      –给指定日期加月份
  LAST_DAY                                                        –指定日期月份最后一天
  NEXT_DAY                                                        –指定日期下一天 第二个参数为1~7，表示周日~周六
                                                                –NEXT_DAY(SYSDATE,7)  表示下一个星期六</p>

<p>–对于日期可使用 四舍五入、取整操作 s是’MONTH’按30天计算15舍16进，s是’YEAR’5舍7如
ROUND(p,s)、TRUNC(p,s)</p>

<p>–其它函数(表达式)
  DECODE(COLUMN,KEY1,VALUE1，KEY2，VALUE2…DEFAULT)
  CASE COLUMN WHEN XXXX THEN XXXX    –等值判断相当于 DECODE
              WHEN XXXX THEN XXXX
              ELSE XXXX END
  CASE WHEN 条件 THEN XXXX           –条件判断
       WHEN 条件 THEN XXXX
       ELSE XXXX END</p>

<p>DISTINCT                           –去重
  CHR()                              –字符转ASCII
  ASCII()                            –ASCII转字符
  SYS_CONTEXT                        –获取上下文环境函数</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  **SYS_CONTEXT函数参考** **[其他参考](http://alany.blog.51cto.com/6125308/1418163)**
  ``` sql
  select sys_context('USERENV','AUTHENTICATION_TYPE') from dual;--用户的认证类型
  select sys_context('USERENV','AUTHENTICATION_DATA') from dual;--未知
  select sys_context('USERENV','BG_JOB_ID') from dual;--当前指定id的会话是否为oracle后台程序建立，不是则返回null
  select sys_context('USERENV','CLIENT_INFO') from dual;--通过dbms_application_info包可以存储高达64字节的用户会话信息
  select sys_context('USERENV','CURRENT_SCHEMA') from dual;--默认的schema将被当做当前的schema。当在当前会话中使用ALTER SESSION SET CURRENT_SCHEMA语句的时候，它的查询返回值将被改变
  select sys_context('USERENV','CURRENT_SCHEMAID') from dual;--当前schema的id
  select sys_context('USERENV','CURRENT_USER') from dual;--当前的登陆用户
  select REPLACE(SUBSTR(sys_context('USERENV','HOST'),1,30),'\',':') from dual;'--当前会话主机操作系统名
  select sys_context('USERENV','CURRENT_USERID') from dual;--当前登陆的用户的id
  select sys_context('USERENV','DB_DOMAIN') from dual;--为数据库的域指定初始化参数
  select sys_context('USERENV','DB_NAME') from dual;--数据库实例名
  select sys_context('USERENV','ENTRYID') from dual;--可用的审计标示符。不能再分布式sql语句中使用此选项。使用USERENV关键字必须置AUDIT_TRAIL的初始化参数为真。
  select sys_context('USERENV','EXTERNAL_NAME') from dual;--数据库用户的扩展名
  select sys_context('USERENV','FG_JOB_ID') from dual;--返回作业id当此会话是客户端进程创建。否则，返回null
  select sys_context('USERENV','INSTANCE') from dual;--当前数据库实例的标示id
  select sys_context('USERENV','ISDBA') from dual;--当前用户是否是以dba身份登录
  select sys_context('USERENV','LANG') from dual;--iso对‘LANGUAGE’的简称，查询的参数比“LANGUAGE”短
  select sys_context('USERENV','LANGUAGE') from dual;--结果为当前数据库使用的存储语言，跟上面查询意义一样
  select sys_context('USERENV','NETWORK_PROTOCOL') from dual;--用于通信的网络协议
  select sys_context('USERENV','NLS_CALENDAR') from dual;--当前会话使用的，格林尼治时间
  select sys_context('USERENV','NLS_CURRENCY') from dual;--本地化的货币符，如人民币为￥，美元符为$
  select sys_context('USERENV','NLS_DATE_FORMAT') from dual;--当前使用的日期格式，一般中国为dd-mon-rr
  select sys_context('USERENV','NLS_DATE_LANGUAGE') from dual;--表示日期的语言，如中文简体SIMPLIFIED CHINESE
  select sys_context('USERENV','NLS_TERRITORY') from dual;--数据库服务器所在区域，如中国CHINA
  select sys_context('USERENV','OS_USER') from dual;--操作系统的用户名
  select sys_context('USERENV','PROXY_USER') from dual;--是否使用代理用户。否返回null
  select sys_context('USERENV','PROXY_USERID') from dual;--代理用户id
  select sys_context('USERENV','SESSION_USER') from dual;--当前认证的数据库用户名
  select sys_context('USERENV','SESSION_USERID') from dual;--当前认证的数据库用户名id
  select sys_context('USERENV','SESSIONID') from dual;--当前会话id
  select sys_context('USERENV','TERMINAL') from dual;--操作系统用户组
  select sys_context('USERENV','IP_ADDRESS') from dual;--当前会话主机ip
  select sys_context('USERENV','HOST') from dual;--当前会话主机操作系统名
</code></pre></div></div>
<ol>
  <li>多行函数
转载请注明出处，本文采用 <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">CC4.0</a> 协议授权</li>
</ol>

    </article>
    <div class="share">
      <div class="share-component"></div>

    </div>
    <div class="comment">
      
    
        
        <!-- Disqus Protection, see https://github.com/mzlogin/mzlogin.github.io/issues/2 -->
        
            <div id="disqus_thread"></div>
            <script>
                var disqus_config = function () {
                    this.page.url = 'https://mritd.me/2016/01/08/DBA%E8%A7%86%E9%A2%91%E7%AC%94%E8%AE%B0/';
                    this.page.identifier = '/2016/01/08/DBA%E8%A7%86%E9%A2%91%E7%AC%94%E8%AE%B0/';
                    this.page.title = 'DBA视频笔记';
                };
                (function() { // DON'T EDIT BELOW THIS LINE
                    var d = document, s = d.createElement('script');
                    s.type = 'text/javascript';
                    s.async = true;
                    var shortname = 'mritd';
                    s.src = '//' + shortname + '.disqus.com/embed.js';
                    s.setAttribute('data-timestamp', +new Date());
                    (d.head || d.body).appendChild(s);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
        
    


    </div>
  </div>
  <div class="column one-fourth">
    
<h3>Search</h3>
<div id="site_search">
    <input type="text" id="search_box" placeholder="Search">
    <button class="btn btn-default" id="site_search_do"><span class="octicon octicon-search"></span></button>
</div>

<ul id="search_results"></ul>

<link rel="stylesheet" type="text/css" href="https://mritd.b0.upaiyun.com/assets/css/modules/sidebar-search.css">
<script src="https://mritd.b0.upaiyun.com/assets/js/lunr.min.js"></script>
<script src="https://mritd.b0.upaiyun.com/assets/js/search.js"></script>

    
<h3>Post Directory</h3>
<div id="post-directory-module" class="mobile-hidden">
  <section class="post-directory">
  <!-- Links that trigger the jumping -->
  <!-- Added by javascript below -->
  <dl></dl>
  </section>
</div>

<script src="https://mritd.b0.upaiyun.com/assets/js/jquery.toc.js"></script>

  </div>
</div>
</section>
<!-- /section.content -->

    <footer class="container">
        <div class="site-footer" role="contentinfo">
            <div class="copyright left mobile-block">
                    © 2017
                    <span title="漠然">漠然</span>
                    <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a>
            </div>

            <ul class="site-footer-links right mobile-hidden">
                <li>
                    <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">CC4.0</a>
                </li>
                <li>
                    <a href="javascript:window.scrollTo(0,0)" >TOP</a>
                </li>
            </ul>
            <a href="http://github.com/mritd/mritd.github.io" target="_blank" aria-label="view source code">
                <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
            </a>
            <ul class="site-footer-links mobile-hidden">
                
                <li>
                    <a href="/" title="首页" target="">首页</a>
                </li>
                
                <li>
                    <a href="/categories/" title="分类" target="">分类</a>
                </li>
                
                <li>
                    <a href="/wiki/" title="维基" target="">维基</a>
                </li>
                
                <li>
                    <a href="/open-source/" title="开源" target="">开源</a>
                </li>
                
                <li>
                    <a href="/links/" title="链接" target="">链接</a>
                </li>
                
                <li>
                    <a href="/about/" title="关于" target="">关于</a>
                </li>
                
                <li><a href="/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li>
            </ul>

        </div>
    </footer>
    <!-- / footer -->
    <script src="https://mritd.b0.upaiyun.com/assets/vendor/share.js/dist/js/share.min.js"></script>
    <script src="https://mritd.b0.upaiyun.com/assets/js/geopattern.js"></script>
    <script src="https://mritd.b0.upaiyun.com/assets/js/prism.js"></script>
    <link rel="stylesheet" href="https://mritd.b0.upaiyun.com/assets/css/globals/prism.css">
    <script>
      jQuery(document).ready(function($) {
        // geopattern
        $('.geopattern').each(function(){
          $(this).geopattern($(this).data('pattern-id'));
        });
       // hljs.initHighlightingOnLoad();
      });
    </script>
    
    <div style="display:none">
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-82387173-1', 'auto');
        ga('send', 'pageview');

      </script>
    </div>
    
</body>
</html>
